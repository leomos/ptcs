<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raccolta Differenziata Partinico</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-48x48.png" type="image/png">
    <meta name="theme-color" content="#008751">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Raccolta Differenziata Partinico">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #008751;
            color: white;
            padding: 15px 20px;
            border-radius: 8px 8px 0 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo img {
            height: 60px;
            margin-right: 10px;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            margin: 0;
        }
        
        .today-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .today-header {
            background-color: #008751;
            color: white;
            padding: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .date-picker-button {
            background-color: white;
            color: #008751;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .date-picker-button:hover {
            background-color: #f0f0f0;
        }
        
        .today-content {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .waste-type {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 20px 0;
            padding: 15px 30px;
            border-radius: 8px;
            color: white;
            text-align: center;
            width: 80%;
        }
        
        .waste-info {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            width: 80%;
        }
        
        .next-days {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .day-card {
            flex: 1;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .day-header {
            background-color: #008751;
            color: white;
            padding: 10px;
            font-weight: bold;
        }
        
        .day-content {
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .small-waste-type {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 10px 0;
            padding: 8px 15px;
            border-radius: 4px;
            color: white;
            text-align: center;
            width: 80%;
        }
        
        .organico { background-color: #8B4513; }
        .secco-residuale { background-color: #808080; }
        .plastica { background-color: #FFD700; color: #333; }
        .carta-cartone { background-color: #4169E1; }
        .vetro-lattine { background-color: #2E8B57; }
        .nessuna-raccolta { background-color: #FF0000; }
        
        .legend {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 15px;
            margin-top: 20px;
        }
        
        .legend h3 {
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            width: calc(50% - 10px);
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
        }
        
        /* Waste Search styles */
        .waste-search-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-top: 20px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .waste-search-header {
            background-color: #008751;
            color: white;
            padding: 15px;
        }
        
        .waste-search-header h3 {
            margin: 0;
        }
        
        .waste-search-content {
            padding: 20px;
        }
        
        .waste-search-form {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .waste-type-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            flex-grow: 1;
        }
        
        .search-waste-button {
            background-color: #008751;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
            font-weight: bold;
        }
        
        .waste-search-results {
            margin-top: 15px;
        }
        
        .results-message {
            text-align: center;
            color: #666;
            margin-bottom: 15px;
        }
        
        .next-pickups h4 {
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .pickup-cards {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .pickup-card {
            flex: 1;
            min-width: 150px;
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .pickup-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background-color: #ccc;
        }
        
        .pickup-card.organico::before { background-color: #8B4513; }
        .pickup-card.secco-residuale::before { background-color: #808080; }
        .pickup-card.plastica::before { background-color: #FFD700; }
        .pickup-card.carta-cartone::before { background-color: #4169E1; }
        .pickup-card.vetro-lattine::before { background-color: #2E8B57; }
        
        .pickup-date {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .pickup-day {
            color: #666;
        }
        
        /* Calendar styles */
        .calendar-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .calendar {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 90%;
            max-width: 400px;
            padding: 20px;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-nav button {
            background-color: #008751;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: bold;
            padding: 5px;
        }
        
        .calendar-day {
            text-align: center;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
        }
        
        .calendar-day:hover {
            background-color: #f0f0f0;
        }
        
        .calendar-day.selected {
            background-color: #008751;
            color: white;
        }
        
        .calendar-day.empty {
            visibility: hidden;
        }
        
        .calendar-day .waste-indicator {
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .calendar-footer {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
        }
        
        .calendar-footer button {
            background-color: #008751;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            cursor: pointer;
        }
        
        /* Install button styles */
        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .install-button {
            background-color: white;
            color: #008751;
            border: 2px solid #008751;
            border-radius: 6px;
            padding: 8px 16px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .install-button:hover {
            background-color: #008751;
            color: white;
            transform: translateY(-1px);
        }
        
        .install-button:active {
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .next-days {
                flex-direction: column;
            }
            
            .legend-item {
                width: 100%;
            }
            
            .calendar {
                width: 95%;
                padding: 15px;
            }
            
            .calendar-day {
                padding: 6px;
                font-size: 0.9rem;
            }
            
            header {
                flex-direction: column;
                padding: 10px;
                gap: 10px;
                margin-bottom: 20px;
            }
            
            .header-actions {
                justify-content: center;
                width: 100%;
                flex-wrap: wrap;
            }
            
            .logo {
                justify-content: center;
                text-align: center;
                width: 100%;
            }
            
            .logo h1 {
                font-size: 1.4rem;
                text-align: center;
            }
            
            .install-button {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            
            .waste-type {
                font-size: 2rem;
                width: 100%;
                padding: 10px 15px;
            }
            
            .waste-info {
                width: 100%;
            }
            
            .waste-search-form {
                flex-direction: column;
                align-items: stretch;
            }
            
            .pickup-cards {
                flex-direction: column;
            }
            
            .pickup-card {
                margin-bottom: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .logo h1 {
                font-size: 1.2rem;
            }
            
            .container {
                padding: 10px;
            }
            
            .today-header {
                font-size: 1.2rem;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MCIgaGVpZ2h0PSI4MCIgdmlld0JveD0iMCAwIDgwIDgwIj48cmVjdCB3aWR0aD0iODAiIGhlaWdodD0iODAiIGZpbGw9IiM1NTg4MzMiLz48dGV4dCB4PSI0MCIgeT0iNDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGFsaWdubWVudC1iYXNlbGluZT0ibWlkZGxlIj5Db211bmUgZGk8L3RleHQ+PHRleHQgeD0iNDAiIHk9IjU1IiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBhbGlnbm1lbnQtYmFzZWxpbmU9Im1pZGRsZSI+UGFydGluaWNvPC90ZXh0Pjwvc3ZnPg==" alt="Comune di Partinico">
                <h1>Raccolta Differenziata - Partinico</h1>
            </div>
            <div class="header-actions">
                <button id="install-button" class="install-button" style="display: none;">
                    📱 Installa
                </button>
                <div class="logo">
                    <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI4MCIgaGVpZ2h0PSI4MCIgdmlld0JveD0iMCAwIDgwIDgwIj48cmVjdCB3aWR0aD0iODAiIGhlaWdodD0iODAiIGZpbGw9IiMwMDg3NTEiLz48dGV4dCB4PSI0MCIgeT0iNDAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGFsaWdubWVudC1iYXNlbGluZT0ibWlkZGxlIj5EVVNUWTwvdGV4dD48dGV4dCB4PSI0MCIgeT0iNTUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGFsaWdubWVudC1iYXNlbGluZT0ibWlkZGxlIj5BbCBzZXJ2aXppbzwvdGV4dD48dGV4dCB4PSI0MCIgeT0iNjUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGFsaWdubWVudC1iYXNlbGluZT0ibWlkZGxlIj5kZWxsJ0FtYmllbnRlPC90ZXh0Pjwvc3ZnPg==" alt="Dusty">
                </div>
            </div>
        </header>
        
        <div class="today-container">
            <div class="today-header">
                <span id="display-date-label">OGGI</span> - <span id="today-date"></span>
                <button id="date-picker-button" class="date-picker-button">Scegli Data</button>
            </div>
            <div class="today-content">
                <div id="today-waste-type" class="waste-type">Caricamento...</div>
                <div class="waste-info">
                    <p>Esponi la frazione all'esterno della tua abitazione dalle ore 20:00 del giorno precedente fino e non oltre le ore 04:00 del giorno indicato.</p>
                </div>
            </div>
        </div>
        
        <div class="next-days">
            <div class="day-card">
                <div class="day-header">
                    SUCCESSIVO - <span id="tomorrow-date"></span>
                </div>
                <div class="day-content">
                    <div id="tomorrow-waste-type" class="small-waste-type">Caricamento...</div>
                </div>
            </div>
            
            <div class="day-card">
                <div class="day-header">
                    2 GIORNI DOPO - <span id="day-after-date"></span>
                </div>
                <div class="day-content">
                    <div id="day-after-waste-type" class="small-waste-type">Caricamento...</div>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <h3>Legenda Rifiuti</h3>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="legend-color organico"></div>
                    <span>Organico</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color secco-residuale"></div>
                    <span>Secco Residuale</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color plastica"></div>
                    <span>Plastica</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color carta-cartone"></div>
                    <span>Carta e Cartone</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color vetro-lattine"></div>
                    <span>Vetro e Lattine</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color nessuna-raccolta"></div>
                    <span>Nessuna Raccolta</span>
                </div>
            </div>
        </div>
        
        <div class="waste-search-container">
            <div class="waste-search-header">
                <h3>Cerca Prossimi Ritiri</h3>
            </div>
            <div class="waste-search-content">
                <div class="waste-search-form">
                    <label for="waste-type-select">Seleziona tipo di rifiuto:</label>
                    <select id="waste-type-select" class="waste-type-select">
                        <option value="ORGANICO">Organico</option>
                        <option value="SECCO RESIDUALE">Secco Residuale</option>
                        <option value="PLASTICA">Plastica</option>
                        <option value="CARTA E CARTONE">Carta e Cartone</option>
                        <option value="VETRO E LATTINE">Vetro e Lattine</option>
                    </select>
                    <button id="search-waste-button" class="search-waste-button">Cerca</button>
                </div>
                <div id="waste-search-results" class="waste-search-results">
                    <div class="results-message">Seleziona un tipo di rifiuto e premi "Cerca" per trovare i prossimi ritiri.</div>
                    <div class="next-pickups" style="display: none;">
                        <h4>Prossimi 3 ritiri:</h4>
                        <div class="pickup-cards">
                            <div class="pickup-card">
                                <div class="pickup-date" id="pickup-date-1">Data</div>
                                <div class="pickup-day" id="pickup-day-1">Giorno</div>
                            </div>
                            <div class="pickup-card">
                                <div class="pickup-date" id="pickup-date-2">Data</div>
                                <div class="pickup-day" id="pickup-day-2">Giorno</div>
                            </div>
                            <div class="pickup-card">
                                <div class="pickup-date" id="pickup-date-3">Data</div>
                                <div class="pickup-day" id="pickup-day-3">Giorno</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>Calendario Raccolta Differenziata Porta a Porta - Comune di Partinico - Anno 2025</p>
            <p>Per informazioni: <strong>800 164 722</strong> | <strong>095 293 85 28</strong></p>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div id="calendar-container" class="calendar-container">
        <div class="calendar">
            <div class="calendar-header">
                <h3 id="calendar-month-year">Mese Anno</h3>
                <div class="calendar-nav">
                    <button id="prev-month">&lt;</button>
                    <button id="next-month">&gt;</button>
                </div>
            </div>
            <div class="calendar-grid" id="calendar-grid">
                <!-- Day headers -->
                <div class="calendar-day-header">L</div>
                <div class="calendar-day-header">M</div>
                <div class="calendar-day-header">M</div>
                <div class="calendar-day-header">G</div>
                <div class="calendar-day-header">V</div>
                <div class="calendar-day-header">S</div>
                <div class="calendar-day-header">D</div>
                
                <!-- Calendar days will be inserted here by JavaScript -->
            </div>
            <div class="calendar-footer">
                <button id="today-button">Oggi</button>
                <button id="close-calendar">Chiudi</button>
            </div>
        </div>
    </div>

    <script>
        // Waste schedule data for 2025
        const wasteSchedule = {
            // Month indexes are 0-based (0 = January, 11 = December)
            0: { // January
                1: "Nessuna Raccolta", 2: "CARTA E CARTONE", 3: "ORGANICO", 4: "PLASTICA", 
                5: "Nessuna Raccolta", // Sunday
                6: "Nessuna Raccolta", 7: "ORGANICO", 8: "SECCO RESIDUALE", 9: "CARTA E CARTONE", 10: "ORGANICO", 
                11: "PLASTICA", 
                12: "Nessuna Raccolta", // Sunday
                13: "ORGANICO", 14: "SECCO RESIDUALE", 15: "VETRO E LATTINE", 
                16: "CARTA E CARTONE", 17: "ORGANICO", 18: "PLASTICA", 
                19: "Nessuna Raccolta", // Sunday
                20: "ORGANICO", 
                21: "SECCO RESIDUALE", 22: "CARTA E CARTONE", 23: "ORGANICO", 24: "ORGANICO", 25: "PLASTICA", 
                26: "Nessuna Raccolta", // Sunday
                27: "ORGANICO", 28: "SECCO RESIDUALE", 29: "VETRO E LATTINE", 30: "CARTA E CARTONE", 31: "ORGANICO"
            },
            1: { // February
                1: "PLASTICA", 
                2: "Nessuna Raccolta", // Sunday
                3: "ORGANICO", 4: "SECCO RESIDUALE", 5: "VETRO E LATTINE", 
                6: "CARTA E CARTONE", 7: "ORGANICO", 8: "PLASTICA", 
                9: "Nessuna Raccolta", // Sunday
                10: "ORGANICO", 
                11: "SECCO RESIDUALE", 12: "VETRO E LATTINE", 13: "CARTA E CARTONE", 14: "ORGANICO", 15: "PLASTICA", 
                16: "Nessuna Raccolta", // Sunday
                17: "ORGANICO", 18: "SECCO RESIDUALE", 19: "VETRO E LATTINE", 20: "CARTA E CARTONE", 
                21: "ORGANICO", 22: "PLASTICA", 
                23: "Nessuna Raccolta", // Sunday
                24: "ORGANICO", 25: "SECCO RESIDUALE", 
                26: "VETRO E LATTINE", 27: "CARTA E CARTONE", 28: "ORGANICO"
            },
            2: { // March
                1: "PLASTICA", 
                2: "Nessuna Raccolta", // Sunday
                3: "ORGANICO", 4: "SECCO RESIDUALE", 5: "VETRO E LATTINE", 
                6: "CARTA E CARTONE", 7: "ORGANICO", 8: "PLASTICA", 
                9: "Nessuna Raccolta", // Sunday
                10: "ORGANICO", 
                11: "SECCO RESIDUO", 12: "VETRO E LATTINE", 13: "CARTA E CARTONE", 14: "ORGANICO", 15: "PLASTICA", 
                16: "Nessuna Raccolta", // Sunday
                17: "ORGANICO", 18: "SECCO RESIDUO", 19: "VETRO E LATTINE", 20: "CARTA E CARTONE", 
                21: "ORGANICO", 22: "PLASTICA", 
                23: "Nessuna Raccolta", // Sunday
                24: "ORGANICO", 25: "SECCO RESIDUO", 
                26: "VETRO E LATTINE", 27: "CARTA E CARTONE", 28: "ORGANICO", 29: "PLASTICA", 
                30: "Nessuna Raccolta", // Sunday
                31: "ORGANICO"
            },
            3: { // April
                1: "SECCO RESIDUALE", 2: "VETRO E LATTINE", 3: "CARTA E CARTONE", 4: "ORGANICO", 5: "PLASTICA", 
                6: "Nessuna Raccolta", // Sunday
                7: "ORGANICO", 8: "SECCO RESIDUALE", 9: "VETRO E LATTINE", 10: "CARTA E CARTONE", 
                11: "ORGANICO", 12: "PLASTICA", 
                13: "Nessuna Raccolta", // Sunday
                14: "ORGANICO", 15: "SECCO RESIDUALE", 
                16: "VETRO E LATTINE", 17: "CARTA E CARTONE", 18: "ORGANICO", 19: "PLASTICA", 
                20: "Nessuna Raccolta", // Sunday
                21: "Nessuna Raccolta", 22: "ORGANICO", 23: "CARTA E CARTONE", 24: "ORGANICO", 25:  "Nessuna Raccolta", 
                26: "PLASTICA", // Sunday
                27: "Nessuna Raccolta", 28: "SECCO RESIDUALE", 29: "VETRO E LATTINE", 30: "ORGANICO"
            },
            4: { // May
                1: "Nessuna Raccolta", 2: "ORGANICO", 3: "PLASTICA", 
                4: "Nessuna Raccolta", // Sunday
                5: "ORGANICO", 6: "SECCO RESIDUALE", 
                7: "VETRO E LATTINE", 8: "CARTA E CARTONE", 9: "ORGANICO", 10: "PLASTICA", 
                11: "Nessuna Raccolta", // Sunday
                12: "ORGANICO", 13: "SECCO RESIDUALE", 14: "VETRO E LATTINE", 15: "CARTA E CARTONE", 
                16: "ORGANICO", 17: "PLASTICA", 
                18: "Nessuna Raccolta", // Sunday
                19: "ORGANICO", 20: "SECCO RESIDUALE", 
                21: "VETRO E LATTINE", 22: "CARTA E CARTONE", 23: "ORGANICO", 24: "PLASTICA", 
                25: "Nessuna Raccolta", // Sunday
                26: "ORGANICO", 27: "SECCO RESIDUALE", 28: "VETRO E LATTINE", 29: "CARTA E CARTONE", 
                30: "ORGANICO", 31: "PLASTICA"
            },
            5: { // June
                1: "Nessuna Raccolta", // Sunday
                2: "Nessuna Raccolta", 3: "ORGANICO", 4: "VETRO E LATTINE", 5: "CARTA E CARTONE", 
                6: "ORGANICO", 7: "PLASTICA", 
                8: "Nessuna Raccolta", // Sunday
                9: "ORGANICO", 10: "SECCO RESIDUALE", 
                11: "VETRO E LATTINE", 12: "CARTA E CARTONE", 13: "ORGANICO", 14: "PLASTICA", 
                15: "Nessuna Raccolta", // Sunday
                16: "ORGANICO", 17: "VETRO E LATTINE", 18: "ORGANICO", 19: "CARTA E CARTONE", 20: "ORGANICO", 
                21: "PLASTICA", 
                22: "Nessuna Raccolta", // Sunday
                23: "ORGANICO", 24: "SECCO RESIDUALE", 25: "ORGANICO", 
                26: "CARTA E CARTONE", 27: "ORGANICO", 28: "PLASTICA", 
                29: "Nessuna Raccolta", // Sunday
                30: "ORGANICO"
            },
            6: { // July
                1: "VETRO E LATTINE", 2: "ORGANICO", 3: "CARTA E CARTONE", 4: "ORGANICO", 5: "PLASTICA", 
                6: "Nessuna Raccolta", // Sunday
                7: "ORGANICO", 8: "SECCO RESIDUALE", 9: "ORGANICO", 10: "CARTA E CARTONE", 
                11: "ORGANICO", 12: "PLASTICA", 
                13: "Nessuna Raccolta", // Sunday
                14: "ORGANICO", 15: "VETRO E LATTINE", 
                16: "ORGANICO", 17: "CARTA E CARTONE", 18: "ORGANICO", 19: "PLASTICA", 
                20: "Nessuna Raccolta", // Sunday
                21: "ORGANICO", 22: "SECCO RESIDUALE", 23: "ORGANICO", 24: "CARTA E CARTONE", 25: "ORGANICO", 
                26: "PLASTICA", 
                27: "Nessuna Raccolta", // Sunday
                28: "ORGANICO", 29: "VETRO E LATTINE", 30: "ORGANICO", 31: "CARTA E CARTONE"
            },
            7: { // August
                1: "ORGANICO", 2: "PLASTICA", 
                3: "Nessuna Raccolta", // Sunday
                4: "ORGANICO", 5: "SECCO RESIDUALE", 
                6: "ORGANICO", 7: "CARTA E CARTONE", 8: "ORGANICO", 9: "PLASTICA", 
                10: "Nessuna Raccolta", // Sunday
                11: "ORGANICO", 12: "VETRO E LATTINE", 13: "ORGANICO", 14: "CARTA E CARTONE", 15: "Nessuna Raccolta", 
                16: "PLASTICA", 
                17: "Nessuna Raccolta", // Sunday
                18: "ORGANICO", 19: "SECCO RESIDUALE", 20: "ORGANICO", 
                21: "CARTA E CARTONE", 22: "ORGANICO", 23: "PLASTICA", 
                24: "Nessuna Raccolta", // Sunday
                25: "ORGANICO", 
                26: "VETRO E LATTINE", 27: "ORGANICO", 28: "CARTA E CARTONE", 29: "ORGANICO", 30: "PLASTICA", 
                31: "Nessuna Raccolta" // Sunday
            },
            8: { // September
                1: "ORGANICO", 2: "SECCO RESIDUALE", 3: "ORGANICO", 4: "CARTA E CARTONE", 5: "ORGANICO", 
                6: "PLASTICA", 
                7: "Nessuna Raccolta", // Sunday
                8: "ORGANICO", 9: "VETRO E LATTINE", 10: "ORGANICO", 
                11: "CARTA E CARTONE", 12: "ORGANICO", 13: "PLASTICA", 
                14: "Nessuna Raccolta", // Sunday
                15: "ORGANICO", 
                16: "SECCO RESIDUALE", 17: "ORGANICO", 18: "CARTA E CARTONE", 19: "ORGANICO", 20: "PLASTICA", 
                21: "Nessuna Raccolta", // Sunday
                22: "ORGANICO", 23: "VETRO E LATTINE", 24: "ORGANICO", 25: "CARTA E CARTONE", 
                26: "ORGANICO", 27: "PLASTICA", 
                28: "Nessuna Raccolta", // Sunday
                29: "ORGANICO", 30: "SECCO RESIDUALE"
            },
            9: { // October
                1: "ORGANICO", 2: "CARTA E CARTONE", 3: "ORGANICO", 4: "PLASTICA", 
                5: "Nessuna Raccolta", // Sunday
                6: "ORGANICO", 7: "VETRO E LATTINE", 8: "ORGANICO", 9: "CARTA E CARTONE", 10: "ORGANICO", 
                11: "PLASTICA", 
                12: "Nessuna Raccolta", // Sunday
                13: "ORGANICO", 14: "SECCO RESIDUALE", 15: "ORGANICO", 
                16: "CARTA E CARTONE", 17: "ORGANICO", 18: "PLASTICA", 
                19: "Nessuna Raccolta", // Sunday
                20: "ORGANICO", 
                21: "VETRO E LATTINE", 22: "ORGANICO", 23: "CARTA E CARTONE", 24: "ORGANICO", 25: "PLASTICA", 
                26: "Nessuna Raccolta", // Sunday
                27: "ORGANICO", 28: "SECCO RESIDUALE", 29: "CARTA E CARTONE", 30: "ORGANICO", 31: "PLASTICA"
            },
            10: { // November
                1: "Nessuna Raccolta", 
                2: "Nessuna Raccolta", // Sunday
                3: "ORGANICO", 4: "VETRO E LATTINE", 5: "CARTA E CARTONE", 
                6: "Nessuna Raccolta", 7: "ORGANICO", 8: "PLASTICA", 
                9: "Nessuna Raccolta", // Sunday
                10: "ORGANICO", 
                11: "SECCO RESIDUALE", 12: "VETRO E LATTINE", 13: "CARTA E CARTONE", 14: "ORGANICO", 
                15: "PLASTICA", 
                16: "Nessuna Raccolta", // Sunday
                17: "ORGANICO", 18: "SECCO RESIDUALE", 19: "VETRO E LATTINE", 
                20: "CARTA E CARTONE", 21: "ORGANICO", 22: "PLASTICA", 
                23: "Nessuna Raccolta", // Sunday
                24: "ORGANICO", 
                25: "SECCO RESIDUALE", 26: "VETRO E LATTINE", 27: "CARTA E CARTONE", 28: "ORGANICO", 
                29: "PLASTICA", 
                30: "Nessuna Raccolta" // Sunday
            },
            11: { // December
                1: "ORGANICO", 2: "SECCO RESIDUALE", 3: "VETRO E LATTINE", 4: "CARTA E CARTONE", 
                5: "ORGANICO", 6: "PLASTICA", 
                7: "Nessuna Raccolta", // Sunday
                8: "Nessuna Raccolta", 9: "ORGANICO", 
                10: "VETRO E LATTINE", 11: "CARTA E CARTONE", 12: "ORGANICO", 13: "PLASTICA", 
                14: "Nessuna Raccolta", // Sunday
                15: "ORGANICO", 16: "SECCO RESIDUALE", 17: "CARTA E CARTONE", 
                18: "ORGANICO", 19: "ORGANICO", 20: "PLASTICA", 
                21: "Nessuna Raccolta", // Sunday
                22: "ORGANICO", 
                23: "SECCO RESIDUALE", 24: "CARTA E CARTONE", 25: "Nessuna Raccolta", 26: "Nessuna Raccolta", 
                27: "PLASTICA", 
                28: "Nessuna Raccolta", // Sunday
                29: "ORGANICO", 30: "VETRO E LATTINE", 31: "CARTA E CARTONE"
            }
        };

        // Function to get the waste type class
        function getWasteTypeClass(wasteType) {
            wasteType = wasteType.toLowerCase();
            if (wasteType.includes("organico")) return "organico";
            if (wasteType.includes("secco")) return "secco-residuale";
            if (wasteType.includes("plastica")) return "plastica";
            if (wasteType.includes("carta")) return "carta-cartone";
            if (wasteType.includes("vetro")) return "vetro-lattine";
            if (wasteType.includes("nessuna")) return "nessuna-raccolta";
            return "";
        }

        // Function to format date as "giorno settimana, DD mese"
        function formatDate(date) {
            const days = ["Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato"];
            const months = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"];
            
            return `${days[date.getDay()]}, ${date.getDate()} ${months[date.getMonth()]}`;
        }

        // Current selected date - ensure it's in 2025
        let selectedDate = new Date();
        // Force the year to be 2025
        selectedDate.setFullYear(2025);
        
        // Function to update the waste type displays
        function updateWasteInfo(date) {
            const displayDate = new Date(date);
            const tomorrow = new Date(displayDate);
            tomorrow.setDate(displayDate.getDate() + 1);
            const dayAfter = new Date(displayDate);
            dayAfter.setDate(displayDate.getDate() + 2);
            
            // Update display date label (OGGI or DATA SELEZIONATA)
            const today = new Date();
            const isToday = displayDate.getDate() === today.getDate() && 
                           displayDate.getMonth() === today.getMonth() && 
                           displayDate.getFullYear() === today.getFullYear();
            
            document.getElementById("display-date-label").textContent = isToday ? "OGGI" : "DATA SELEZIONATA";
            
            // Set dates
            document.getElementById("today-date").textContent = formatDate(displayDate);
            document.getElementById("tomorrow-date").textContent = formatDate(tomorrow);
            document.getElementById("day-after-date").textContent = formatDate(dayAfter);
            
            // Get waste types
            const displayDateWaste = wasteSchedule[displayDate.getMonth()][displayDate.getDate()] || "Nessuna Raccolta";
            const tomorrowWaste = wasteSchedule[tomorrow.getMonth()][tomorrow.getDate()] || "Nessuna Raccolta";
            const dayAfterWaste = wasteSchedule[dayAfter.getMonth()][dayAfter.getDate()] || "Nessuna Raccolta";
            
            // Set waste types with appropriate classes
            const todayWasteElement = document.getElementById("today-waste-type");
            todayWasteElement.textContent = displayDateWaste;
            todayWasteElement.className = "waste-type " + getWasteTypeClass(displayDateWaste);
            
            const tomorrowWasteElement = document.getElementById("tomorrow-waste-type");
            tomorrowWasteElement.textContent = tomorrowWaste;
            tomorrowWasteElement.className = "small-waste-type " + getWasteTypeClass(tomorrowWaste);
            
            const dayAfterWasteElement = document.getElementById("day-after-waste-type");
            dayAfterWasteElement.textContent = dayAfterWaste;
            dayAfterWasteElement.className = "small-waste-type " + getWasteTypeClass(dayAfterWaste);
        }
        
        // Calendar functionality
        const calendarContainer = document.getElementById("calendar-container");
        const calendarGrid = document.getElementById("calendar-grid");
        const calendarMonthYear = document.getElementById("calendar-month-year");
        const prevMonthButton = document.getElementById("prev-month");
        const nextMonthButton = document.getElementById("next-month");
        const todayButton = document.getElementById("today-button");
        const closeCalendarButton = document.getElementById("close-calendar");
        const datePickerButton = document.getElementById("date-picker-button");
        
        let currentCalendarDate = new Date();
        // Force the year to be 2025
        currentCalendarDate.setFullYear(2025);
        
        // Open calendar when date picker button is clicked
        datePickerButton.addEventListener("click", function() {
            calendarContainer.style.display = "flex";
            currentCalendarDate = new Date(selectedDate);
            renderCalendar(currentCalendarDate);
        });
        
        // Close calendar
        closeCalendarButton.addEventListener("click", function() {
            calendarContainer.style.display = "none";
        });
        
        // Navigate to previous month
        prevMonthButton.addEventListener("click", function() {
            // Check if going to previous month would go before 2025
            if (currentCalendarDate.getFullYear() === 2025 && currentCalendarDate.getMonth() === 0) {
                return; // Don't allow going before January 2025
            }
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar(currentCalendarDate);
        });
        
        // Navigate to next month
        nextMonthButton.addEventListener("click", function() {
            // Check if going to next month would go beyond 2025
            if (currentCalendarDate.getFullYear() === 2025 && currentCalendarDate.getMonth() === 11) {
                return; // Don't allow going beyond December 2025
            }
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar(currentCalendarDate);
        });
        
        // Go to today
        todayButton.addEventListener("click", function() {
            selectedDate = new Date();
            // Force the year to be 2025
            selectedDate.setFullYear(2025);
            updateWasteInfo(selectedDate);
            calendarContainer.style.display = "none";
        });
        
        // Close calendar when clicking outside
        calendarContainer.addEventListener("click", function(e) {
            if (e.target === calendarContainer) {
                calendarContainer.style.display = "none";
            }
        });
        
        // Render calendar for a given month
        function renderCalendar(date) {
            // Update month and year display
            const months = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"];
            calendarMonthYear.textContent = `${months[date.getMonth()]} ${date.getFullYear()}`;
            
            // Clear previous calendar days (except headers)
            const dayHeaders = Array.from(calendarGrid.querySelectorAll(".calendar-day-header"));
            calendarGrid.innerHTML = "";
            
            // Re-add day headers
            dayHeaders.forEach(header => calendarGrid.appendChild(header));
            
            // Get first day of month and total days
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            const totalDays = lastDay.getDate();
            
            // Adjust for Monday as first day of week (0 = Monday, 6 = Sunday)
            let firstDayIndex = firstDay.getDay() - 1;
            if (firstDayIndex < 0) firstDayIndex = 6; // Sunday becomes 6
            
            // Add empty cells for days before first day of month
            for (let i = 0; i < firstDayIndex; i++) {
                const emptyDay = document.createElement("div");
                emptyDay.className = "calendar-day empty";
                calendarGrid.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= totalDays; day++) {
                const dayElement = document.createElement("div");
                dayElement.className = "calendar-day";
                dayElement.textContent = day;
                
                // Check if this is the selected date
                const currentDate = new Date(date.getFullYear(), date.getMonth(), day);
                if (currentDate.getDate() === selectedDate.getDate() && 
                    currentDate.getMonth() === selectedDate.getMonth() && 
                    currentDate.getFullYear() === selectedDate.getFullYear()) {
                    dayElement.classList.add("selected");
                }
                
                // Add waste type indicator
                const wasteType = wasteSchedule[date.getMonth()][day];
                if (wasteType) {
                    const indicator = document.createElement("div");
                    indicator.className = "waste-indicator " + getWasteTypeClass(wasteType);
                    dayElement.appendChild(indicator);
                }
                
                // Add click event to select date
                dayElement.addEventListener("click", function() {
                    selectedDate = new Date(date.getFullYear(), date.getMonth(), day);
                    updateWasteInfo(selectedDate);
                    calendarContainer.style.display = "none";
                });
                
                calendarGrid.appendChild(dayElement);
            }
        }
        
        // Initialize the page
        updateWasteInfo(selectedDate);
        
        // Waste Search Functionality
        const wasteTypeSelect = document.getElementById("waste-type-select");
        const searchWasteButton = document.getElementById("search-waste-button");
        const wasteSearchResults = document.getElementById("waste-search-results");
        const nextPickups = wasteSearchResults.querySelector(".next-pickups");
        const resultsMessage = wasteSearchResults.querySelector(".results-message");
        
        // Function to find the next occurrences of a specific waste type
        function findNextWastePickups(wasteType, startDate, count = 3) {
            const results = [];
            const currentDate = new Date(startDate);
            
            // Ensure we're looking at 2025
            currentDate.setFullYear(2025);
            
            // Start from tomorrow
            currentDate.setDate(currentDate.getDate() + 1);
            
            // Loop until we find the requested number of occurrences
            while (results.length < count) {
                const month = currentDate.getMonth();
                const day = currentDate.getDate();
                
                // Check if this day has the requested waste type
                if (wasteSchedule[month] && 
                    wasteSchedule[month][day] && 
                    wasteSchedule[month][day] === wasteType) {
                    
                    // Add to results
                    results.push(new Date(currentDate));
                }
                
                // Move to next day
                currentDate.setDate(currentDate.getDate() + 1);
                
                // Prevent infinite loop if we can't find enough occurrences
                // (shouldn't happen with our data, but just in case)
                if (currentDate.getFullYear() > 2025) {
                    break;
                }
            }
            
            return results;
        }
        
        // Handle search button click
        searchWasteButton.addEventListener("click", function() {
            const selectedWasteType = wasteTypeSelect.value;
            const pickupDates = findNextWastePickups(selectedWasteType, new Date());
            
            if (pickupDates.length === 0) {
                resultsMessage.textContent = "Nessun ritiro trovato per questo tipo di rifiuto.";
                resultsMessage.style.display = "block";
                nextPickups.style.display = "none";
                return;
            }
            
            // Update the pickup cards with the found dates
            for (let i = 0; i < pickupDates.length; i++) {
                const dateElement = document.getElementById(`pickup-date-${i+1}`);
                const dayElement = document.getElementById(`pickup-day-${i+1}`);
                
                if (dateElement && dayElement) {
                    const date = pickupDates[i];
                    dateElement.textContent = `${date.getDate()} ${["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"][date.getMonth()]}`;
                    dayElement.textContent = ["Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato"][date.getDay()];
                    
                    // Add color class based on waste type
                    const parentCard = dateElement.closest('.pickup-card');
                    if (parentCard) {
                        // Remove any existing waste type classes
                        parentCard.classList.remove("organico", "secco-residuale", "plastica", "carta-cartone", "vetro-lattine");
                        // Add the appropriate class
                        parentCard.classList.add(getWasteTypeClass(selectedWasteType));
                    }
                }
            }
            
            // Show the results
            resultsMessage.style.display = "none";
            nextPickups.style.display = "block";
        });
        
        // PWA Installation functionality
        let deferredPrompt;
        const installButton = document.getElementById('install-button');
        
        // Listen for the beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Save the event so it can be triggered later
            deferredPrompt = e;
            // Show the install button
            installButton.style.display = 'flex';
        });
        
        // Handle install button click
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt
                const { outcome } = await deferredPrompt.userChoice;
                // Clear the deferredPrompt for future use
                deferredPrompt = null;
                // Hide the install button
                installButton.style.display = 'none';
            }
        });
        
        // Listen for the app to be installed
        window.addEventListener('appinstalled', (e) => {
            // Hide the install button
            installButton.style.display = 'none';
            // Clear the deferredPrompt
            deferredPrompt = null;
        });
        
        // Check if app is already installed (for iOS and other platforms)
        window.addEventListener('DOMContentLoaded', () => {
            // For iOS Safari, check if running in standalone mode
            if (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
                installButton.style.display = 'none';
            }
        });
    </script>
</body>
</html>
