<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raccolta Differenziata Partinico</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-48x48.png" type="image/png">
    <meta name="theme-color" content="#005e25">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Raccolta Differenziata Partinico">
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192x192.png">

    <!-- Bootstrap Italia CSS -->
    <link rel="stylesheet" href="bootstrap-italia/css/bootstrap-italia.min.css">
    <!-- Custom Theme CSS -->
    <link rel="stylesheet" href="custom-theme.css">

</head>

<body>
    <!-- Bootstrap Italia Header -->
    <header class="it-header-wrapper">
        <div class="it-header-slim-wrapper">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <div class="it-header-slim-wrapper-content">
                            <div class="header-slim-left">
                                <div class="d-flex align-items-center">
                                    <img src="/cropped-Partinico-Logo-New.png" alt="Comune di Partinico" height="40"
                                        class="me-2">
                                    <div class="it-brand-text">
                                        <h1 class="it-brand-title">Raccolta Differenziata - Partinico</h1>
                                    </div>
                                </div>
                            </div>
                            <div class="header-slim-right">
                                <div class="d-flex align-items-center gap-3">
                                    <button id="install-button" class="btn btn-outline-light btn-sm install-button"
                                        style="display: none;">
                                        <svg class="icon icon-sm me-1 dark">
                                            <use href="bootstrap-italia/svg/sprites.svg#it-plus"></use>
                                        </svg>
                                        Installa
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Container -->
    <div class="container">

        <!-- Today's Waste Text -->
        <div class="mb-4 mt-2">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    <span id="display-date-label">OGGI</span> - <span id="today-date"></span>
                </h5>
                <button id="date-picker-button" class="btn btn-sm btn-outline">
                    <svg class="icon icon-sm me-1">
                        <use href="bootstrap-italia/svg/sprites.svg#it-calendar"></use>
                    </svg>
                    Scegli data
                </button>
            </div>
            <div class="text-center">
                <div id="today-waste-type" class="badge-waste mb-3">Caricamento...</div>
                <p class="mb-0">Esponi la frazione all'esterno della tua abitazione dalle ore 20:00 del giorno
                    precedente fino e non oltre le ore 04:00 del giorno indicato.</p>
            </div>
        </div>

        <!-- Next Days Cards -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="mb-4 mt-2">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">
                            SUCCESSIVO - <span id="tomorrow-date"></span>
                        </h6>
                    </div>
                    <div class="text-center">
                        <div id="tomorrow-waste-type" class="badge-waste small">Caricamento...</div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="mb-4 mt-2">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">
                            2 GIORNI DOPO - <span id="day-after-date"></span>
                        </h6>
                    </div>
                    <div class="text-center">
                        <div id="day-after-waste-type" class="badge-waste small">Caricamento...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Legend Card -->
        <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    Legenda rifiuti
                </h5>
            </div>
            <div class="row">
                <div class="col-md-6 col-12 mb-2">
                    <div class="d-flex align-items-center">
                        <span class="legend-color organico me-2"></span>
                        <span>Organico</span>
                    </div>
                </div>
                <div class="col-md-6 col-12 mb-2">
                    <div class="d-flex align-items-center">
                        <span class="legend-color secco-residuale me-2"></span>
                        <span>Secco Residuale</span>
                    </div>
                </div>
                <div class="col-md-6 col-12 mb-2">
                    <div class="d-flex align-items-center">
                        <span class="legend-color plastica me-2"></span>
                        <span>Plastica</span>
                    </div>
                </div>
                <div class="col-md-6 col-12 mb-2">
                    <div class="d-flex align-items-center">
                        <span class="legend-color carta-cartone me-2"></span>
                        <span>Carta e Cartone</span>
                    </div>
                </div>
                <div class="col-md-6 col-12 mb-2">
                    <div class="d-flex align-items-center">
                        <span class="legend-color vetro-lattine me-2"></span>
                        <span>Vetro e Lattine</span>
                    </div>
                </div>
                <div class="col-md-6 col-12 mb-2">
                    <div class="d-flex align-items-center">
                        <span class="legend-color nessuna-raccolta me-2"></span>
                        <span>Nessuna Raccolta</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Waste Search Card -->
        <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5 class="mb-0">
                    Cerca prossimi ritiri
                </h5>
            </div>
            <div class="row align-items-center mb-3 py-2">
                <div class="col select-wrapper">
                    <select id="waste-type-select" class="form-control">
                        <option value="ORGANICO">Organico</option>
                        <option value="SECCO RESIDUALE">Secco Residuale</option>
                        <option value="PLASTICA">Plastica</option>
                        <option value="CARTA E CARTONE">Carta e Cartone</option>
                        <option value="VETRO E LATTINE">Vetro e Lattine</option>
                    </select>
                </div>
                <div class="col">
                    <button id="search-waste-button" class="btn btn-primary mt-2">
                        <svg class="icon icon-light icon-sm me-1">
                            <use href="bootstrap-italia/svg/sprites.svg#it-search"></use>
                        </svg>
                        Cerca
                    </button>
                </div>
            </div>
            <div id="waste-search-results">
                <div class="results-message text-center text-muted">
                    Seleziona un tipo di rifiuto e premi "Cerca" per trovare i prossimi ritiri.
                </div>
                <div class="next-pickups" style="display: none;">
                    <h6>Prossimi 3 ritiri:</h6>
                    <div class="row">
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="it-card pickup-card">
                                <div class="it-card-body text-center">
                                    <div class="pickup-date fw-bold" id="pickup-date-1">Data</div>
                                    <div class="pickup-day text-muted" id="pickup-day-1">Giorno</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="it-card pickup-card">
                                <div class="it-card-body text-center">
                                    <div class="pickup-date fw-bold" id="pickup-date-2">Data</div>
                                    <div class="pickup-day text-muted" id="pickup-day-2">Giorno</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-6 mb-3">
                            <div class="it-card pickup-card">
                                <div class="it-card-body text-center">
                                    <div class="pickup-date fw-bold" id="pickup-date-3">Data</div>
                                    <div class="pickup-day text-muted" id="pickup-day-3">Giorno</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-5">
            <div class="text-center text-muted">
                <p class="mb-2">Calendario Raccolta Differenziata Porta a Porta - Comune di Partinico - Anno 2025</p>
                <p class="mb-0">Per informazioni: <strong>800 164 722</strong> | <strong>095 293 85 28</strong></p>
            </div>
        </footer>
    </div>

    <!-- Bootstrap Italia Calendar Modal -->
    <div class="modal fade" id="calendar-container" tabindex="-1" aria-labelledby="calendarModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="calendar-month-year">Mese Anno</h5>
                    <div class="d-flex gap-2 mb-2">
                        <button type="button" class="btn btn-primary btn-xs" id="prev-month">
                            <svg class="icon icon-xs icon-light">
                                <use href="bootstrap-italia/svg/sprites.svg#it-chevron-left"></use>
                            </svg>
                        </button>
                        <button type="button" class="btn btn-primary btn-xs" id="next-month">
                            <svg class="icon icon-xs icon-light">
                                <use href="bootstrap-italia/svg/sprites.svg#it-chevron-right"></use>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="modal-body">
                    <div class="calendar-grid" id="calendar-grid">
                        <!-- Day headers -->
                        <div class="calendar-day-header">L</div>
                        <div class="calendar-day-header">M</div>
                        <div class="calendar-day-header">M</div>
                        <div class="calendar-day-header">G</div>
                        <div class="calendar-day-header">V</div>
                        <div class="calendar-day-header">S</div>
                        <div class="calendar-day-header">D</div>

                        <!-- Calendar days will be inserted here by JavaScript -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="today-button">Oggi</button>
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal"
                        id="close-calendar">Chiudi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Italia JavaScript -->
    <script src="bootstrap-italia/js/bootstrap-italia.bundle.min.js"></script>

    <script>
        bootstrap.loadFonts('/bootstrap-italia/fonts');
        // Waste schedule data - format: YYYY-MM-DD
        const wasteSchedule = {
            // January 2025
            "2025-01-01": "Nessuna Raccolta",
            "2025-01-02": "CARTA E CARTONE",
            "2025-01-03": "ORGANICO",
            "2025-01-04": "PLASTICA",
            "2025-01-05": "Nessuna Raccolta",
            "2025-01-06": "Nessuna Raccolta",
            "2025-01-07": "ORGANICO",
            "2025-01-08": "SECCO RESIDUALE",
            "2025-01-09": "CARTA E CARTONE",
            "2025-01-10": "ORGANICO",
            "2025-01-11": "PLASTICA",
            "2025-01-12": "Nessuna Raccolta",
            "2025-01-13": "ORGANICO",
            "2025-01-14": "SECCO RESIDUALE",
            "2025-01-15": "VETRO E LATTINE",
            "2025-01-16": "CARTA E CARTONE",
            "2025-01-17": "ORGANICO",
            "2025-01-18": "PLASTICA",
            "2025-01-19": "Nessuna Raccolta",
            "2025-01-20": "ORGANICO",
            "2025-01-21": "SECCO RESIDUALE",
            "2025-01-22": "CARTA E CARTONE",
            "2025-01-23": "ORGANICO",
            "2025-01-24": "ORGANICO",
            "2025-01-25": "PLASTICA",
            "2025-01-26": "Nessuna Raccolta",
            "2025-01-27": "ORGANICO",
            "2025-01-28": "SECCO RESIDUALE",
            "2025-01-29": "VETRO E LATTINE",
            "2025-01-30": "CARTA E CARTONE",
            "2025-01-31": "ORGANICO",
            // February 2025
            "2025-02-01": "PLASTICA",
            "2025-02-02": "Nessuna Raccolta",
            "2025-02-03": "ORGANICO",
            "2025-02-04": "SECCO RESIDUALE",
            "2025-02-05": "VETRO E LATTINE",
            "2025-02-06": "CARTA E CARTONE",
            "2025-02-07": "ORGANICO",
            "2025-02-08": "PLASTICA",
            "2025-02-09": "Nessuna Raccolta",
            "2025-02-10": "ORGANICO",
            "2025-02-11": "SECCO RESIDUALE",
            "2025-02-12": "VETRO E LATTINE",
            "2025-02-13": "CARTA E CARTONE",
            "2025-02-14": "ORGANICO",
            "2025-02-15": "PLASTICA",
            "2025-02-16": "Nessuna Raccolta",
            "2025-02-17": "ORGANICO",
            "2025-02-18": "SECCO RESIDUALE",
            "2025-02-19": "VETRO E LATTINE",
            "2025-02-20": "CARTA E CARTONE",
            "2025-02-21": "ORGANICO",
            "2025-02-22": "PLASTICA",
            "2025-02-23": "Nessuna Raccolta",
            "2025-02-24": "ORGANICO",
            "2025-02-25": "SECCO RESIDUALE",
            "2025-02-26": "VETRO E LATTINE",
            "2025-02-27": "CARTA E CARTONE",
            "2025-02-28": "ORGANICO",
            // March 2025
            "2025-03-01": "PLASTICA",
            "2025-03-02": "Nessuna Raccolta",
            "2025-03-03": "ORGANICO",
            "2025-03-04": "SECCO RESIDUO",
            "2025-03-05": "VETRO E LATTINE",
            "2025-03-06": "CARTA E CARTONE",
            "2025-03-07": "ORGANICO",
            "2025-03-08": "PLASTICA",
            "2025-03-09": "Nessuna Raccolta",
            "2025-03-10": "ORGANICO",
            "2025-03-11": "SECCO RESIDUO",
            "2025-03-12": "VETRO E LATTINE",
            "2025-03-13": "CARTA E CARTONE",
            "2025-03-14": "ORGANICO",
            "2025-03-15": "PLASTICA",
            "2025-03-16": "Nessuna Raccolta",
            "2025-03-17": "ORGANICO",
            "2025-03-18": "SECCO RESIDUO",
            "2025-03-19": "VETRO E LATTINE",
            "2025-03-20": "CARTA E CARTONE",
            "2025-03-21": "ORGANICO",
            "2025-03-22": "PLASTICA",
            "2025-03-23": "Nessuna Raccolta",
            "2025-03-24": "ORGANICO",
            "2025-03-25": "SECCO RESIDUO",
            "2025-03-26": "VETRO E LATTINE",
            "2025-03-27": "CARTA E CARTONE",
            "2025-03-28": "ORGANICO",
            "2025-03-29": "PLASTICA",
            "2025-03-30": "Nessuna Raccolta",
            "2025-03-31": "ORGANICO",
            // April 2025
            "2025-04-01": "SECCO RESIDUALE",
            "2025-04-02": "VETRO E LATTINE",
            "2025-04-03": "CARTA E CARTONE",
            "2025-04-04": "ORGANICO",
            "2025-04-05": "PLASTICA",
            "2025-04-06": "Nessuna Raccolta",
            "2025-04-07": "ORGANICO",
            "2025-04-08": "SECCO RESIDUALE",
            "2025-04-09": "VETRO E LATTINE",
            "2025-04-10": "CARTA E CARTONE",
            "2025-04-11": "ORGANICO",
            "2025-04-12": "PLASTICA",
            "2025-04-13": "Nessuna Raccolta",
            "2025-04-14": "ORGANICO",
            "2025-04-15": "SECCO RESIDUALE",
            "2025-04-16": "VETRO E LATTINE",
            "2025-04-17": "CARTA E CARTONE",
            "2025-04-18": "ORGANICO",
            "2025-04-19": "PLASTICA",
            "2025-04-20": "Nessuna Raccolta",
            "2025-04-21": "Nessuna Raccolta",
            "2025-04-22": "ORGANICO",
            "2025-04-23": "CARTA E CARTONE",
            "2025-04-24": "ORGANICO",
            "2025-04-25": "Nessuna Raccolta",
            "2025-04-26": "PLASTICA",
            "2025-04-27": "Nessuna Raccolta",
            "2025-04-28": "SECCO RESIDUALE",
            "2025-04-29": "VETRO E LATTINE",
            "2025-04-30": "ORGANICO",
            // May 2025
            "2025-05-01": "Nessuna Raccolta",
            "2025-05-02": "ORGANICO",
            "2025-05-03": "PLASTICA",
            "2025-05-04": "Nessuna Raccolta",
            "2025-05-05": "ORGANICO",
            "2025-05-06": "SECCO RESIDUALE",
            "2025-05-07": "VETRO E LATTINE",
            "2025-05-08": "CARTA E CARTONE",
            "2025-05-09": "ORGANICO",
            "2025-05-10": "PLASTICA",
            "2025-05-11": "Nessuna Raccolta",
            "2025-05-12": "ORGANICO",
            "2025-05-13": "SECCO RESIDUALE",
            "2025-05-14": "VETRO E LATTINE",
            "2025-05-15": "CARTA E CARTONE",
            "2025-05-16": "ORGANICO",
            "2025-05-17": "PLASTICA",
            "2025-05-18": "Nessuna Raccolta",
            "2025-05-19": "ORGANICO",
            "2025-05-20": "SECCO RESIDUALE",
            "2025-05-21": "VETRO E LATTINE",
            "2025-05-22": "CARTA E CARTONE",
            "2025-05-23": "ORGANICO",
            "2025-05-24": "PLASTICA",
            "2025-05-25": "Nessuna Raccolta",
            "2025-05-26": "ORGANICO",
            "2025-05-27": "SECCO RESIDUALE",
            "2025-05-28": "VETRO E LATTINE",
            "2025-05-29": "CARTA E CARTONE",
            "2025-05-30": "ORGANICO",
            "2025-05-31": "PLASTICA",
            // June 2025
            "2025-06-01": "Nessuna Raccolta",
            "2025-06-02": "Nessuna Raccolta",
            "2025-06-03": "ORGANICO",
            "2025-06-04": "VETRO E LATTINE",
            "2025-06-05": "CARTA E CARTONE",
            "2025-06-06": "ORGANICO",
            "2025-06-07": "PLASTICA",
            "2025-06-08": "Nessuna Raccolta",
            "2025-06-09": "ORGANICO",
            "2025-06-10": "SECCO RESIDUALE",
            "2025-06-11": "VETRO E LATTINE",
            "2025-06-12": "CARTA E CARTONE",
            "2025-06-13": "ORGANICO",
            "2025-06-14": "PLASTICA",
            "2025-06-15": "Nessuna Raccolta",
            "2025-06-16": "ORGANICO",
            "2025-06-17": "VETRO E LATTINE",
            "2025-06-18": "ORGANICO",
            "2025-06-19": "CARTA E CARTONE",
            "2025-06-20": "ORGANICO",
            "2025-06-21": "PLASTICA",
            "2025-06-22": "Nessuna Raccolta",
            "2025-06-23": "ORGANICO",
            "2025-06-24": "SECCO RESIDUALE",
            "2025-06-25": "ORGANICO",
            "2025-06-26": "CARTA E CARTONE",
            "2025-06-27": "ORGANICO",
            "2025-06-28": "PLASTICA",
            "2025-06-29": "Nessuna Raccolta",
            "2025-06-30": "ORGANICO",
            // July 2025
            "2025-07-01": "VETRO E LATTINE",
            "2025-07-02": "ORGANICO",
            "2025-07-03": "CARTA E CARTONE",
            "2025-07-04": "ORGANICO",
            "2025-07-05": "PLASTICA",
            "2025-07-06": "Nessuna Raccolta",
            "2025-07-07": "ORGANICO",
            "2025-07-08": "SECCO RESIDUALE",
            "2025-07-09": "ORGANICO",
            "2025-07-10": "CARTA E CARTONE",
            "2025-07-11": "ORGANICO",
            "2025-07-12": "PLASTICA",
            "2025-07-13": "Nessuna Raccolta",
            "2025-07-14": "ORGANICO",
            "2025-07-15": "VETRO E LATTINE",
            "2025-07-16": "ORGANICO",
            "2025-07-17": "CARTA E CARTONE",
            "2025-07-18": "ORGANICO",
            "2025-07-19": "PLASTICA",
            "2025-07-20": "Nessuna Raccolta",
            "2025-07-21": "ORGANICO",
            "2025-07-22": "SECCO RESIDUALE",
            "2025-07-23": "ORGANICO",
            "2025-07-24": "CARTA E CARTONE",
            "2025-07-25": "ORGANICO",
            "2025-07-26": "PLASTICA",
            "2025-07-27": "Nessuna Raccolta",
            "2025-07-28": "ORGANICO",
            "2025-07-29": "VETRO E LATTINE",
            "2025-07-30": "ORGANICO",
            "2025-07-31": "CARTA E CARTONE",
            // August 2025
            "2025-08-01": "ORGANICO",
            "2025-08-02": "PLASTICA",
            "2025-08-03": "Nessuna Raccolta",
            "2025-08-04": "ORGANICO",
            "2025-08-05": "SECCO RESIDUALE",
            "2025-08-06": "ORGANICO",
            "2025-08-07": "CARTA E CARTONE",
            "2025-08-08": "ORGANICO",
            "2025-08-09": "PLASTICA",
            "2025-08-10": "Nessuna Raccolta",
            "2025-08-11": "ORGANICO",
            "2025-08-12": "VETRO E LATTINE",
            "2025-08-13": "ORGANICO",
            "2025-08-14": "CARTA E CARTONE",
            "2025-08-15": "Nessuna Raccolta",
            "2025-08-16": "PLASTICA",
            "2025-08-17": "Nessuna Raccolta",
            "2025-08-18": "ORGANICO",
            "2025-08-19": "SECCO RESIDUALE",
            "2025-08-20": "ORGANICO",
            "2025-08-21": "CARTA E CARTONE",
            "2025-08-22": "ORGANICO",
            "2025-08-23": "PLASTICA",
            "2025-08-24": "Nessuna Raccolta",
            "2025-08-25": "ORGANICO",
            "2025-08-26": "VETRO E LATTINE",
            "2025-08-27": "ORGANICO",
            "2025-08-28": "CARTA E CARTONE",
            "2025-08-29": "ORGANICO",
            "2025-08-30": "PLASTICA",
            "2025-08-31": "Nessuna Raccolta",
            // September 2025
            "2025-09-01": "ORGANICO",
            "2025-09-02": "SECCO RESIDUALE",
            "2025-09-03": "ORGANICO",
            "2025-09-04": "CARTA E CARTONE",
            "2025-09-05": "ORGANICO",
            "2025-09-06": "PLASTICA",
            "2025-09-07": "Nessuna Raccolta",
            "2025-09-08": "ORGANICO",
            "2025-09-09": "VETRO E LATTINE",
            "2025-09-10": "ORGANICO",
            "2025-09-11": "CARTA E CARTONE",
            "2025-09-12": "ORGANICO",
            "2025-09-13": "PLASTICA",
            "2025-09-14": "Nessuna Raccolta",
            "2025-09-15": "ORGANICO",
            "2025-09-16": "SECCO RESIDUALE",
            "2025-09-17": "ORGANICO",
            "2025-09-18": "CARTA E CARTONE",
            "2025-09-19": "ORGANICO",
            "2025-09-20": "PLASTICA",
            "2025-09-21": "Nessuna Raccolta",
            "2025-09-22": "ORGANICO",
            "2025-09-23": "VETRO E LATTINE",
            "2025-09-24": "ORGANICO",
            "2025-09-25": "CARTA E CARTONE",
            "2025-09-26": "ORGANICO",
            "2025-09-27": "PLASTICA",
            "2025-09-28": "Nessuna Raccolta",
            "2025-09-29": "ORGANICO",
            "2025-09-30": "SECCO RESIDUALE",
            // October 2025
            "2025-10-01": "ORGANICO",
            "2025-10-02": "CARTA E CARTONE",
            "2025-10-03": "ORGANICO",
            "2025-10-04": "PLASTICA",
            "2025-10-05": "Nessuna Raccolta",
            "2025-10-06": "ORGANICO",
            "2025-10-07": "VETRO E LATTINE",
            "2025-10-08": "ORGANICO",
            "2025-10-09": "CARTA E CARTONE",
            "2025-10-10": "ORGANICO",
            "2025-10-11": "PLASTICA",
            "2025-10-12": "Nessuna Raccolta",
            "2025-10-13": "ORGANICO",
            "2025-10-14": "SECCO RESIDUALE",
            "2025-10-15": "ORGANICO",
            "2025-10-16": "CARTA E CARTONE",
            "2025-10-17": "ORGANICO",
            "2025-10-18": "PLASTICA",
            "2025-10-19": "Nessuna Raccolta",
            "2025-10-20": "ORGANICO",
            "2025-10-21": "VETRO E LATTINE",
            "2025-10-22": "ORGANICO",
            "2025-10-23": "CARTA E CARTONE",
            "2025-10-24": "ORGANICO",
            "2025-10-25": "PLASTICA",
            "2025-10-26": "Nessuna Raccolta",
            "2025-10-27": "ORGANICO",
            "2025-10-28": "SECCO RESIDUALE",
            "2025-10-29": "CARTA E CARTONE",
            "2025-10-30": "ORGANICO",
            "2025-10-31": "PLASTICA",
            // November 2025
            "2025-11-01": "Nessuna Raccolta",
            "2025-11-02": "Nessuna Raccolta",
            "2025-11-03": "ORGANICO",
            "2025-11-04": "VETRO E LATTINE",
            "2025-11-05": "CARTA E CARTONE",
            "2025-11-06": "Nessuna Raccolta",
            "2025-11-07": "ORGANICO",
            "2025-11-08": "PLASTICA",
            "2025-11-09": "Nessuna Raccolta",
            "2025-11-10": "ORGANICO",
            "2025-11-11": "SECCO RESIDUALE",
            "2025-11-12": "VETRO E LATTINE",
            "2025-11-13": "CARTA E CARTONE",
            "2025-11-14": "ORGANICO",
            "2025-11-15": "PLASTICA",
            "2025-11-16": "Nessuna Raccolta",
            "2025-11-17": "ORGANICO",
            "2025-11-18": "SECCO RESIDUALE",
            "2025-11-19": "VETRO E LATTINE",
            "2025-11-20": "CARTA E CARTONE",
            "2025-11-21": "ORGANICO",
            "2025-11-22": "PLASTICA",
            "2025-11-23": "Nessuna Raccolta",
            "2025-11-24": "ORGANICO",
            "2025-11-25": "SECCO RESIDUALE",
            "2025-11-26": "VETRO E LATTINE",
            "2025-11-27": "CARTA E CARTONE",
            "2025-11-28": "ORGANICO",
            "2025-11-29": "PLASTICA",
            "2025-11-30": "Nessuna Raccolta",
            // December 2025
            "2025-12-01": "ORGANICO",
            "2025-12-02": "SECCO RESIDUALE",
            "2025-12-03": "VETRO E LATTINE",
            "2025-12-04": "CARTA E CARTONE",
            "2025-12-05": "ORGANICO",
            "2025-12-06": "PLASTICA",
            "2025-12-07": "Nessuna Raccolta",
            "2025-12-08": "Nessuna Raccolta",
            "2025-12-09": "ORGANICO",
            "2025-12-10": "VETRO E LATTINE",
            "2025-12-11": "CARTA E CARTONE",
            "2025-12-12": "ORGANICO",
            "2025-12-13": "PLASTICA",
            "2025-12-14": "Nessuna Raccolta",
            "2025-12-15": "ORGANICO",
            "2025-12-16": "SECCO RESIDUALE",
            "2025-12-17": "CARTA E CARTONE",
            "2025-12-18": "ORGANICO",
            "2025-12-19": "ORGANICO",
            "2025-12-20": "PLASTICA",
            "2025-12-21": "Nessuna Raccolta",
            "2025-12-22": "ORGANICO",
            "2025-12-23": "SECCO RESIDUALE",
            "2025-12-24": "CARTA E CARTONE",
            "2025-12-25": "Nessuna Raccolta",
            "2025-12-26": "Nessuna Raccolta",
            "2025-12-27": "PLASTICA",
            "2025-12-28": "Nessuna Raccolta",
            "2025-12-29": "ORGANICO",
            "2025-12-30": "VETRO E LATTINE",
            "2025-12-31": "CARTA E CARTONE",
            // January 2026
            "2026-01-01": "Nessuna Raccolta",
            "2026-01-02": "ORGANICO",
            "2026-01-03": "PLASTICA",
            "2026-01-04": "Nessuna Raccolta",
            "2026-01-05": "ORGANICO",
            "2026-01-06": "Nessuna Raccolta",
            "2026-01-07": "SECCO RESIDUALE",
            "2026-01-08": "CARTA E CARTONE",
            "2026-01-09": "ORGANICO",
            "2026-01-10": "PLASTICA",
            "2026-01-11": "Nessuna Raccolta",
            "2026-01-12": "ORGANICO",
            "2026-01-13": "SECCO RESIDUALE",
            "2026-01-14": "VETRO E LATTINE",
            "2026-01-15": "CARTA E CARTONE",
            "2026-01-16": "ORGANICO",
            "2026-01-17": "PLASTICA",
            "2026-01-18": "Nessuna Raccolta",
            "2026-01-19": "ORGANICO",
            "2026-01-20": "SECCO RESIDUALE",
            "2026-01-21": "VETRO E LATTINE",
            "2026-01-22": "CARTA E CARTONE",
            "2026-01-23": "ORGANICO",
            "2026-01-24": "PLASTICA",
            "2026-01-25": "Nessuna Raccolta",
            "2026-01-26": "ORGANICO",
            "2026-01-27": "SECCO RESIDUALE",
            "2026-01-28": "VETRO E LATTINE",
            "2026-01-29": "CARTA E CARTONE",
            "2026-01-30": "ORGANICO",
            "2026-01-31": "PLASTICA",
            // February 2026
            "2026-02-01": "Nessuna Raccolta",
            "2026-02-02": "ORGANICO",
            "2026-02-03": "PLASTICA",
            "2026-02-04": "VETRO E LATTINE",
            "2026-02-05": "CARTA E CARTONE",
            "2026-02-06": "ORGANICO",
            "2026-02-07": "PLASTICA",
            "2026-02-08": "Nessuna Raccolta",
            "2026-02-09": "ORGANICO",
            "2026-02-10": "SECCO RESIDUALE",
            "2026-02-11": "VETRO E LATTINE",
            "2026-02-12": "CARTA E CARTONE",
            "2026-02-13": "ORGANICO",
            "2026-02-14": "PLASTICA",
            "2026-02-15": "Nessuna Raccolta",
            "2026-02-16": "ORGANICO",
            "2026-02-17": "SECCO RESIDUALE",
            "2026-02-18": "VETRO E LATTINE",
            "2026-02-19": "CARTA E CARTONE",
            "2026-02-20": "ORGANICO",
            "2026-02-21": "PLASTICA",
            "2026-02-22": "Nessuna Raccolta",
            "2026-02-23": "ORGANICO",
            "2026-02-24": "SECCO RESIDUALE",
            "2026-02-25": "VETRO E LATTINE",
            "2026-02-26": "CARTA E CARTONE",
            "2026-02-27": "ORGANICO",
            "2026-02-28": "PLASTICA",
            // March 2026
            "2026-03-01": "Nessuna Raccolta",
            "2026-03-02": "ORGANICO",
            "2026-03-03": "SECCO RESIDUALE",
            "2026-03-04": "VETRO E LATTINE",
            "2026-03-05": "CARTA E CARTONE",
            "2026-03-06": "ORGANICO",
            "2026-03-07": "PLASTICA",
            "2026-03-08": "Nessuna Raccolta",
            "2026-03-09": "ORGANICO",
            "2026-03-10": "SECCO RESIDUALE",
            "2026-03-11": "VETRO E LATTINE",
            "2026-03-12": "CARTA E CARTONE",
            "2026-03-13": "ORGANICO",
            "2026-03-14": "PLASTICA",
            "2026-03-15": "Nessuna Raccolta",
            "2026-03-16": "ORGANICO",
            "2026-03-17": "SECCO RESIDUALE",
            "2026-03-18": "VETRO E LATTINE",
            "2026-03-19": "CARTA E CARTONE",
            "2026-03-20": "ORGANICO",
            "2026-03-21": "PLASTICA",
            "2026-03-22": "Nessuna Raccolta",
            "2026-03-23": "ORGANICO",
            "2026-03-24": "SECCO RESIDUALE",
            "2026-03-25": "VETRO E LATTINE",
            "2026-03-26": "CARTA E CARTONE",
            "2026-03-27": "ORGANICO",
            "2026-03-28": "PLASTICA",
            "2026-03-29": "Nessuna Raccolta",
            "2026-03-30": "ORGANICO",
            "2026-03-31": "SECCO RESIDUALE",
        };

        // Helper function to format date as YYYY-MM-DD
        function formatDateKey(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Helper function to get min date from schedule
        function getMinDate() {
            return new Date(2025, 0, 1); // January 1, 2025
        }

        // Helper function to get max date from schedule
        function getMaxDate() {
            return new Date(2026, 2, 31); // January 31, 2026
        }

        // Helper function to check if date is within valid range
        function isDateInRange(date) {
            const minDate = getMinDate();
            const maxDate = getMaxDate();
            return date >= minDate && date <= maxDate;
        }

        // Function to get the waste type class
        function getWasteTypeClass(wasteType) {
            wasteType = wasteType.toLowerCase();
            if (wasteType.includes("organico")) return "organico";
            if (wasteType.includes("secco")) return "secco-residuale";
            if (wasteType.includes("plastica")) return "plastica";
            if (wasteType.includes("carta")) return "carta-cartone";
            if (wasteType.includes("vetro")) return "vetro-lattine";
            if (wasteType.includes("nessuna")) return "nessuna-raccolta";
            return "";
        }

        // Function to format date as "giorno settimana, DD mese"
        function formatDate(date) {
            const days = ["Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato"];
            const months = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"];

            return `${days[date.getDay()]}, ${date.getDate()} ${months[date.getMonth()]}`;
        }

        let selectedDate = new Date();
        selectedDate.setFullYear(2026);

        // Function to update the waste type displays
        function updateWasteInfo(date) {
            const displayDate = new Date(date);
            const tomorrow = new Date(displayDate);
            tomorrow.setDate(displayDate.getDate() + 1);
            const dayAfter = new Date(displayDate);
            dayAfter.setDate(displayDate.getDate() + 2);

            // Update display date label (OGGI or DATA SELEZIONATA)
            const today = new Date();
            const isToday = displayDate.getDate() === today.getDate() &&
                displayDate.getMonth() === today.getMonth() &&
                displayDate.getFullYear() === today.getFullYear();

            document.getElementById("display-date-label").textContent = isToday ? "OGGI" : "DATA SELEZIONATA";

            // Set dates
            document.getElementById("today-date").textContent = formatDate(displayDate);
            document.getElementById("tomorrow-date").textContent = formatDate(tomorrow);
            document.getElementById("day-after-date").textContent = formatDate(dayAfter);

            // Get waste types using new format
            const displayDateWaste = wasteSchedule[formatDateKey(displayDate)] || "Nessuna Raccolta";
            const tomorrowWaste = wasteSchedule[formatDateKey(tomorrow)] || "Nessuna Raccolta";
            const dayAfterWaste = wasteSchedule[formatDateKey(dayAfter)] || "Nessuna Raccolta";

            // Set waste types with appropriate classes
            const todayWasteElement = document.getElementById("today-waste-type");
            todayWasteElement.textContent = displayDateWaste;
            todayWasteElement.className = "badge-waste mb-4 " + getWasteTypeClass(displayDateWaste);

            const tomorrowWasteElement = document.getElementById("tomorrow-waste-type");
            tomorrowWasteElement.textContent = tomorrowWaste;
            tomorrowWasteElement.className = "badge-waste small " + getWasteTypeClass(tomorrowWaste);

            const dayAfterWasteElement = document.getElementById("day-after-waste-type");
            dayAfterWasteElement.textContent = dayAfterWaste;
            dayAfterWasteElement.className = "badge-waste small " + getWasteTypeClass(dayAfterWaste);
        }

        // Calendar functionality
        const calendarContainer = document.getElementById("calendar-container");
        const calendarGrid = document.getElementById("calendar-grid");
        const calendarMonthYear = document.getElementById("calendar-month-year");
        const prevMonthButton = document.getElementById("prev-month");
        const nextMonthButton = document.getElementById("next-month");
        const todayButton = document.getElementById("today-button");
        const closeCalendarButton = document.getElementById("close-calendar");
        const datePickerButton = document.getElementById("date-picker-button");

        let currentCalendarDate = new Date();
        // Force the year to be 2025
        currentCalendarDate.setFullYear(2025);

        // Bootstrap Modal instance
        let calendarModal;

        // Initialize Bootstrap modal when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            calendarModal = new bootstrap.Modal(document.getElementById('calendar-container'));
        });

        // Open calendar when date picker button is clicked
        datePickerButton.addEventListener("click", function () {
            currentCalendarDate = new Date(selectedDate);
            renderCalendar(currentCalendarDate);
            calendarModal.show();
        });

        // Close calendar
        closeCalendarButton.addEventListener("click", function () {
            calendarModal.hide();
        });

        // Navigate to previous month
        prevMonthButton.addEventListener("click", function () {
            const minDate = getMinDate();
            const testDate = new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth() - 1, 1);
            
            // Don't allow going before minDate
            if (testDate < minDate) {
                return;
            }
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar(currentCalendarDate);
        });

        // Navigate to next month
        nextMonthButton.addEventListener("click", function () {
            const maxDate = getMaxDate();
            const testDate = new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth() + 1, 1);
            
            // Don't allow going beyond maxDate's month
            if (testDate.getFullYear() > maxDate.getFullYear() || 
                (testDate.getFullYear() === maxDate.getFullYear() && testDate.getMonth() > maxDate.getMonth())) {
                return;
            }
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar(currentCalendarDate);
        });

        // Go to today
        todayButton.addEventListener("click", function () {
            const today = new Date();
            if (isDateInRange(today)) {
                selectedDate = today;
            } else {
                // Default to minDate if today is out of range
                selectedDate = getMinDate();
            }
            updateWasteInfo(selectedDate);
            calendarModal.hide();
        });

        // Render calendar for a given month
        function renderCalendar(date) {
            // Update month and year display
            const months = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"];
            calendarMonthYear.textContent = `${months[date.getMonth()]} ${date.getFullYear()}`;

            // Clear previous calendar days (except headers)
            const dayHeaders = Array.from(calendarGrid.querySelectorAll(".calendar-day-header"));
            calendarGrid.innerHTML = "";

            // Re-add day headers
            dayHeaders.forEach(header => calendarGrid.appendChild(header));

            // Get first day of month and total days
            const firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
            const lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
            const totalDays = lastDay.getDate();

            // Adjust for Monday as first day of week (0 = Monday, 6 = Sunday)
            let firstDayIndex = firstDay.getDay() - 1;
            if (firstDayIndex < 0) firstDayIndex = 6; // Sunday becomes 6

            // Add empty cells for days before first day of month
            for (let i = 0; i < firstDayIndex; i++) {
                const emptyDay = document.createElement("div");
                emptyDay.className = "calendar-day empty";
                calendarGrid.appendChild(emptyDay);
            }

            // Add days of the month
            for (let day = 1; day <= totalDays; day++) {
                const dayElement = document.createElement("div");
                dayElement.className = "calendar-day";
                dayElement.textContent = day;

                // Check if this is the selected date
                const currentDate = new Date(date.getFullYear(), date.getMonth(), day);
                if (currentDate.getDate() === selectedDate.getDate() &&
                    currentDate.getMonth() === selectedDate.getMonth() &&
                    currentDate.getFullYear() === selectedDate.getFullYear()) {
                    dayElement.classList.add("selected");
                }

                // Add waste type indicator using new format
                const dateKey = formatDateKey(currentDate);
                const wasteType = wasteSchedule[dateKey];
                if (wasteType) {
                    const indicator = document.createElement("div");
                    indicator.className = "waste-indicator " + getWasteTypeClass(wasteType);
                    dayElement.appendChild(indicator);
                }

                // Add click event to select date
                dayElement.addEventListener("click", function () {
                    selectedDate = new Date(date.getFullYear(), date.getMonth(), day);
                    updateWasteInfo(selectedDate);
                    calendarModal.hide();
                });

                calendarGrid.appendChild(dayElement);
            }
        }

        // Initialize the page
        updateWasteInfo(selectedDate);

        // Waste Search Functionality
        const wasteTypeSelect = document.getElementById("waste-type-select");
        const searchWasteButton = document.getElementById("search-waste-button");
        const wasteSearchResults = document.getElementById("waste-search-results");
        const nextPickups = wasteSearchResults.querySelector(".next-pickups");
        const resultsMessage = wasteSearchResults.querySelector(".results-message");

        // Function to find the next occurrences of a specific waste type
        function findNextWastePickups(wasteType, startDate, count = 3) {
            const results = [];
            const currentDate = new Date(startDate);
            const maxDate = getMaxDate();

            // Start from tomorrow
            currentDate.setDate(currentDate.getDate() + 1);

            // Loop until we find the requested number of occurrences
            while (results.length < count && currentDate <= maxDate) {
                const dateKey = formatDateKey(currentDate);
                const wasteForDay = wasteSchedule[dateKey];

                // Check if this day has the requested waste type
                if (wasteForDay && wasteForDay === wasteType) {
                    // Add to results
                    results.push(new Date(currentDate));
                }

                // Move to next day
                currentDate.setDate(currentDate.getDate() + 1);
            }

            return results;
        }

        // Handle search button click
        searchWasteButton.addEventListener("click", function () {
            const selectedWasteType = wasteTypeSelect.value;
            const pickupDates = findNextWastePickups(selectedWasteType, new Date());

            if (pickupDates.length === 0) {
                resultsMessage.textContent = "Nessun ritiro trovato per questo tipo di rifiuto.";
                resultsMessage.style.display = "block";
                nextPickups.style.display = "none";
                return;
            }

            // Update the pickup cards with the found dates
            for (let i = 0; i < pickupDates.length; i++) {
                const dateElement = document.getElementById(`pickup-date-${i + 1}`);
                const dayElement = document.getElementById(`pickup-day-${i + 1}`);

                if (dateElement && dayElement) {
                    const date = pickupDates[i];
                    dateElement.textContent = `${date.getDate()} ${["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"][date.getMonth()]}`;
                    dayElement.textContent = ["Domenica", "Lunedì", "Martedì", "Mercoledì", "Giovedì", "Venerdì", "Sabato"][date.getDay()];

                    // Add color class based on waste type
                    const parentCard = dateElement.closest('.pickup-card');
                    if (parentCard) {
                        // Remove any existing waste type classes
                        parentCard.classList.remove("organico", "secco-residuale", "plastica", "carta-cartone", "vetro-lattine");
                        // Add the appropriate class
                        parentCard.classList.add(getWasteTypeClass(selectedWasteType));
                    }
                }
            }

            // Show the results
            resultsMessage.style.display = "none";
            nextPickups.style.display = "block";
        });

        // PWA Installation functionality
        let deferredPrompt;
        const installButton = document.getElementById('install-button');

        // Listen for the beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Save the event so it can be triggered later
            deferredPrompt = e;
            // Show the install button
            installButton.style.display = 'flex';
        });

        // Handle install button click
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt
                const { outcome } = await deferredPrompt.userChoice;
                // Clear the deferredPrompt for future use
                deferredPrompt = null;
                // Hide the install button
                installButton.style.display = 'none';
            }
        });

        // Listen for the app to be installed
        window.addEventListener('appinstalled', (e) => {
            // Hide the install button
            installButton.style.display = 'none';
            // Clear the deferredPrompt
            deferredPrompt = null;
        });

        // Check if app is already installed (for iOS and other platforms)
        window.addEventListener('DOMContentLoaded', () => {
            // For iOS Safari, check if running in standalone mode
            if (window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches) {
                installButton.style.display = 'none';
            }
        });
    </script>
</body>

</html>
